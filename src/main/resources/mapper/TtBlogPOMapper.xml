<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.library.eroge.erogelib.mapper.TtBlogPOMapper">
    <resultMap id="BaseResultMap" type="com.library.eroge.erogelib.entity.TtBlogPO">
      <id column="BLOG_ID" jdbcType="BIGINT" property="blogId" />
      <result column="BLOG_TITLE" jdbcType="VARCHAR" property="blogTitle" />
        <result column="IMG_URL" jdbcType="VARCHAR" property="imgUrl" />
      <result column="BLOG_CONTENT" jdbcType="VARCHAR" property="blogContent" />
      <result column="BLOG_STATUS" jdbcType="INTEGER" property="blogStatus" />
      <result column="CREATE_BY" jdbcType="VARCHAR" property="createBy" />
        <result column="CREATE_BY_NAME" jdbcType="VARCHAR" property="createByName" />
      <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
      <result column="UPDATE_BY" jdbcType="VARCHAR" property="updateBy" />
        <result column="UPDATE_BY_NAME" jdbcType="VARCHAR" property="updateByName" />
      <result column="UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate" />
      <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    </resultMap>
    <sql id="Base_Column_List">
      BLOG_ID, BLOG_TITLE, BLOG_CONTENT, BLOG_STATUS, CREATE_BY, CREATE_DATE, UPDATE_BY,
      UPDATE_DATE, REMARK, CREATE_BY_NAME , UPDATE_BY_NAME
    </sql>

    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
      select
      <include refid="Base_Column_List" />
      from tt_blog
      where BLOG_ID = #{blogId,jdbcType=BIGINT}
    </select>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
      delete from tt_blog
      where BLOG_ID = #{blogId,jdbcType=BIGINT}
    </delete>

    <select id="queryBlogList" resultType="com.library.eroge.erogelib.dto.BlogTagsDTO">
      SELECT
        B.BLOG_ID,BLOG_TITLE,BLOG_CONTENT,BLOG_STATUS,B.CREATE_BY_NAME,B.UPDATE_BY_NAME,
        B.CREATE_BY,B.CREATE_DATE,B.UPDATE_BY,B.UPDATE_DATE,B.IMG_URL,
        GROUP_CONCAT(TBT.TAG_NAME ORDER BY TBT.CREATE_DATE SEPARATOR ',') tagNames,
        GROUP_CONCAT(TBT.TAG_ID ORDER BY TBT.CREATE_DATE SEPARATOR ',') tagIds
      FROM (
        SELECT
            B.BLOG_ID,BLOG_TITLE,BLOG_CONTENT,BLOG_STATUS,
            B.CREATE_BY,B.CREATE_DATE,UPDATE_BY,UPDATE_DATE,
            CREATE_BY_NAME,UPDATE_BY_NAME,IMG_URL
        FROM TT_BLOG B
        WHERE B.CREATE_BY = #{params.userId}
        AND B.BLOG_STATUS = 11311001
      ) B
      LEFT JOIN TT_BLOG_TAG TBT ON B.BLOG_ID = TBT.BLOG_ID AND B.CREATE_BY = TBT.CREATE_BY
      GROUP BY B.BLOG_ID
      ORDER BY B.BLOG_ID DESC
    </select>

    <select id="queryUserTags" resultType="com.library.eroge.erogelib.dto.UserTagsDTO">
      SELECT TAG_NAME , COUNT(1) TAG_COUNT
      FROM TT_BLOG_TAG
      WHERE CREATE_BY = #{params.userId}
      GROUP BY TAG_NAME
      ORDER BY COUNT(TAG_NAME) DESC
    </select>
</mapper>